<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Store - Urbaneats</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <link rel="shortcut icon" href="assets/img/logourbaneats.png" type="image/x-icon">
  <style>
    /* Store products grid: 2 columns on mobile, responsive on larger screens */
    .store-grid{ display:grid; gap:12px; }
    @media (max-width: 768px){ .store-grid{ grid-template-columns: 1fr 1fr; } }
    @media (min-width: 769px){ .store-grid{ grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); } }
    .card img{ border-bottom-left-radius:0; border-bottom-right-radius:0; }
    .card .card-body{ padding:10px }
  </style>
  <script>
    // Require login
    try {
      if (!localStorage.getItem('urbaneats_user')) {
        const next = encodeURIComponent(location.pathname + location.search);
        location.replace(`login.html?next=${next}`);
      }
    } catch {}
  </script>
</head>
<body>
<script src="assets/js/loader.js"></script>
<header class="site-header" style="background-color:black;">
  <div class="container header-inner">
    <a class="brand" href="menu.html"><img src="assets/img/logourbaneats.png" alt="Urbaneats logo" class="brand-logo"></a>
    <div id="header-action"></div>
  </div>
</header>

<main class="container" style="padding:24px 16px">
  <nav class="muted small" style="margin-bottom:8px"><a href="menu.html">Stores</a> › <span id="storeNameCrumb">Store</span></nav>
  <h1 id="storeTitle">Store</h1>
  <p class="muted" id="storeSubtitle" style="margin-top:0">Products available from this store.</p>

  <section id="storeProducts" class="store-grid"></section>
  <p id="emptyMsg" class="muted" style="display:none">No products found for this store yet.</p>
</main>

<footer class="site-footer">
  <div class="container footer-grid">
    <div>
      <a class="brand" href="/"><img src="assets/img/logourbaneats.png" alt="Urbaneats logo" class="brand-logo"></a>
      <p class="muted">Delicious food, delivered fast. Order from the best spots in town.</p>
    </div>
    <nav class="footer-col">
      <h4>Explore</h4>
      <a href="menu.html">Menu</a>
      <a href="#">Offers</a>
      <a href="#">About</a>
    </nav>
    <nav class="footer-col">
      <h4>Support</h4>
      <a href="#">Help Center</a>
      <a href="#">Privacy</a>
      <a href="#">Terms</a>
      <a href="admin.html">Admin</a>
    </nav>
    <div class="footer-col">
      <h4>Get in touch</h4>
      <p class="muted small">Email: urbaneats@example.com</p>
      <p class="muted small">Phone/WhatsApp: +44 1234 567890</p>
    </div>
  </div>
  <div class="container footer-bottom">
    <p>© <span id="year"></span> Urbaneats</p>
  </div>
</footer>

<script>document.getElementById('year').textContent = new Date().getFullYear();</script>
<script type="module">
  import { listProducts } from './assets/js/auth.js';

  // Header action (login/profile)
  (function(){
    const wrap = document.getElementById('header-action');
    let u=null; try{ u = JSON.parse(localStorage.getItem('urbaneats_user')||'null'); }catch{}
    wrap.innerHTML = u ? `<a class=\"icon-btn\" href=\"profile.html\" title=\"${u.displayName||u.email}\">\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z\" fill=\"currentColor\"/><path d=\"M4 20.25A8.25 8.25 0 0 1 12.25 12h-.5A8.25 8.25 0 0 1 20 20.25c0 .966-.784 1.75-1.75 1.75H5.75A1.75 1.75 0 0 1 4 20.25Z\" fill=\"currentColor\"/></svg>\n    </a>` : `<a class="btn login" href="login.html">Login</a>`;
  })();

  // Known stores map (fallback)
  const STORES = {
    'waffledom': { name: 'Waffledom' },
    'superstore': { name: 'Superstore' },
    'onile-ebi': { name: 'Onile ebi' },
    'flakkys': { name: "Flakky's" },
    'bgh': { name: 'Guest House' },
  };

  const params = new URLSearchParams(location.search);
  const storeId = params.get('storeId') || '';
  const storeName = (STORES[storeId]?.name) || storeId || 'Store';
  document.getElementById('storeNameCrumb').textContent = storeName;
  document.getElementById('storeTitle').textContent = storeName;

  function cardHtml(p){
    return `
      <a class="card" href="product.html?id=${encodeURIComponent(p.id)}" style="overflow:hidden;border:1px solid var(--border);border-radius:12px;background:#fff;text-decoration:none;color:inherit">
        <img src="${p.imageUrl||'assets/img/placeholder.png'}" alt="${p.name}" style="width:100%;height:140px;object-fit:cover" onerror="this.src='assets/img/placeholder.png'" />
        <div class="card-body" style="padding:10px">
          <h3 style="margin:0 0 6px;font-size:16px">${p.name}</h3>
          <div class="muted small" style="margin-bottom:6px">₦${Number(p.price||0).toLocaleString()}</div>
          <p class="muted small" style="margin:0">${p.about||''}</p>
        </div>
      </a>
    `;
  }

  async function loadStoreProducts(){
    const grid = document.getElementById('storeProducts');
    const empty = document.getElementById('emptyMsg');
    grid.innerHTML = '<p class="muted">Loading…</p>';
    try{
      const all = await listProducts();
      const items = all.filter(p => (p.storeId||'') === storeId);
      if (!items.length){
        grid.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';
      // Simple grid render
      grid.innerHTML = items.map(cardHtml).join('');
    }catch(e){
      grid.innerHTML = '<p class="muted">Failed to load products</p>';
    }
  }

  loadStoreProducts();
</script>
</body>
</html>
